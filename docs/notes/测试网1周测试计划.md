# 🧪 测试网1周测试计划

## 📅 时间安排
**测试周期**: 7天  
**环境**: Ethereum Sepolia / Polygon Amoy / BSC Testnet  
**目标**: 验证系统稳定性和功能完整性

---

## 🎯 测试目标

### **主要目标**
- ✅ 验证后端API功能完整性
- ✅ 测试真实区块链交互
- ✅ 发现并修复潜在问题
- ✅ 监控系统性能和稳定性
- ✅ 无需前端，使用工具测试

### **成功标准**
- API可用性 > 99%
- 所有核心功能正常
- 无严重Bug
- 性能符合预期

---

## 📋 测试前准备

### **1. 启动测试网环境**

```bash
# 1. 复制测试网配置
cp env.testnet.example .env

# 2. 创建测试数据库目录
mkdir -p data

# 3. 启动服务
export $(cat .env | xargs)
cargo run --release --bin hot_wallet
```

### **2. 获取测试币**

#### **Ethereum Sepolia**
```
水龙头: https://sepoliafaucet.com/
需要: Alchemy账号
每次: 0.5 SepoliaETH
```

#### **Polygon Amoy**
```
水龙头: https://faucet.polygon.technology/
需要: 钱包地址
每次: 0.5 MATIC
```

#### **BSC Testnet**
```
水龙头: https://testnet.bnbchain.org/faucet-smart
需要: 钱包地址
每次: 0.5 tBNB
```

### **3. 选择测试工具**

#### **选项A: curl脚本** (最简单)
```bash
chmod +x test_api_manual.sh
./test_api_manual.sh
```

#### **选项B: Python脚本** (更清晰)
```bash
pip install requests
python3 test_api.py
```

#### **选项C: Postman** (最友好)
```
1. 打开Postman
2. 导入 Postman测试集合.json
3. 运行集合
```

---

## 📅 每日测试计划

### **Day 1: 基础功能测试** 🚀

**测试内容**:
- [ ] API健康检查
- [ ] 创建钱包 (5个不同名称)
- [ ] 列出钱包
- [ ] 查询余额 (多个网络)
- [ ] 备份钱包

**测试命令**:
```bash
# 创建多个钱包
for i in {1..5}; do
  curl -X POST "http://localhost:8888/api/wallets" \
    -H "Authorization: testnet_api_key" \
    -H "Content-Type: application/json" \
    -d "{\"name\": \"wallet_$i\", \"quantum_safe\": false}"
  sleep 2
done

# 列出所有钱包
curl -X GET "http://localhost:8888/api/wallets" \
  -H "Authorization: testnet_api_key"
```

**成功标准**:
- ✅ 所有钱包创建成功
- ✅ 余额查询返回0或实际余额
- ✅ 备份数据包含助记词

---

### **Day 2: 交易发送测试** 💸

**测试内容**:
- [ ] 从水龙头获取测试币
- [ ] 发送小额交易 (0.001 ETH)
- [ ] 查询交易状态
- [ ] 查看交易历史
- [ ] 验证余额变化

**步骤**:
```bash
# 1. 获取钱包地址
curl -X GET "http://localhost:8888/api/wallets" \
  -H "Authorization: testnet_api_key" \
  | jq '.[0].address'

# 2. 从水龙头获取测试币 (手动访问网站)

# 3. 等待10分钟后查询余额
curl -X GET "http://localhost:8888/api/wallets/wallet_1/balance?network=sepolia" \
  -H "Authorization: testnet_api_key"

# 4. 发送测试交易
curl -X POST "http://localhost:8888/api/wallets/wallet_1/send" \
  -H "Authorization: testnet_api_key" \
  -H "Content-Type: application/json" \
  -d '{
    "to_address": "0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb",
    "amount": "0.001",
    "network": "sepolia"
  }'
```

**成功标准**:
- ✅ 交易成功提交
- ✅ 返回交易哈希
- ✅ 可在区块浏览器查看
- ✅ 余额正确减少

---

### **Day 3: 多链测试** 🔗

**测试内容**:
- [ ] Ethereum Sepolia
- [ ] Polygon Amoy
- [ ] BSC Testnet
- [ ] Solana Devnet

**测试每个链**:
```bash
for network in sepolia polygon bsc solana-devnet; do
  echo "测试网络: $network"
  
  # 查询余额
  curl -X GET "http://localhost:8888/api/wallets/wallet_1/balance?network=$network" \
    -H "Authorization: testnet_api_key"
  
  sleep 2
done
```

**成功标准**:
- ✅ 所有链都能查询余额
- ✅ 交易广播成功
- ✅ 无网络错误

---

### **Day 4: 压力测试** 💪

**测试内容**:
- [ ] 并发创建钱包 (50个)
- [ ] 并发查询余额 (100次)
- [ ] 连续发送交易
- [ ] API响应时间

**压力测试脚本**:
```bash
# 并发创建钱包
for i in {1..50}; do
  (curl -X POST "http://localhost:8888/api/wallets" \
    -H "Authorization: testnet_api_key" \
    -H "Content-Type: application/json" \
    -d "{\"name\": \"stress_wallet_$i\", \"quantum_safe\": false}" &)
done
wait

# 并发查询余额
for i in {1..100}; do
  (curl -X GET "http://localhost:8888/api/wallets/wallet_1/balance?network=sepolia" \
    -H "Authorization: testnet_api_key" &)
done
wait
```

**成功标准**:
- ✅ 所有请求成功
- ✅ 无超时错误
- ✅ 响应时间 < 2秒
- ✅ 无内存泄漏

---

### **Day 5: 备份恢复测试** 🔄

**测试内容**:
- [ ] 备份钱包
- [ ] 删除钱包
- [ ] 使用助记词恢复
- [ ] 验证地址一致
- [ ] 验证余额一致

**测试流程**:
```bash
# 1. 备份钱包
BACKUP=$(curl -X GET "http://localhost:8888/api/wallets/wallet_1/backup" \
  -H "Authorization: testnet_api_key" \
  | jq -r '.seed_phrase')

echo "备份助记词: $BACKUP"

# 2. 记录原始地址
ORIGINAL_ADDR=$(curl -X GET "http://localhost:8888/api/wallets" \
  -H "Authorization: testnet_api_key" \
  | jq -r '.[0].address')

# 3. 删除钱包
curl -X DELETE "http://localhost:8888/api/wallets/wallet_1" \
  -H "Authorization: testnet_api_key"

# 4. 恢复钱包
curl -X POST "http://localhost:8888/api/wallets/restore" \
  -H "Authorization: testnet_api_key" \
  -H "Content-Type: application/json" \
  -d "{
    \"name\": \"wallet_1_restored\",
    \"seed_phrase\": \"$BACKUP\",
    \"quantum_safe\": false
  }"

# 5. 验证地址
RESTORED_ADDR=$(curl -X GET "http://localhost:8888/api/wallets" \
  -H "Authorization: testnet_api_key" \
  | jq -r '.[0].address')

if [ "$ORIGINAL_ADDR" == "$RESTORED_ADDR" ]; then
  echo "✅ 地址匹配成功！"
else
  echo "❌ 地址不匹配！"
fi
```

**成功标准**:
- ✅ 恢复后地址一致
- ✅ 余额正确
- ✅ 交易历史保留

---

### **Day 6: 安全测试** 🔒

**测试内容**:
- [ ] 无效API密钥
- [ ] SQL注入尝试
- [ ] 超大请求体
- [ ] 恶意地址
- [ ] 速率限制

**安全测试**:
```bash
# 1. 测试无效API密钥
curl -X GET "http://localhost:8888/api/wallets" \
  -H "Authorization: wrong_key"
# 预期: 401 Unauthorized

# 2. 测试SQL注入
curl -X POST "http://localhost:8888/api/wallets" \
  -H "Authorization: testnet_api_key" \
  -H "Content-Type: application/json" \
  -d '{"name": "wallet\"; DROP TABLE wallets--", "quantum_safe": false}'
# 预期: 400 Bad Request 或正常拒绝

# 3. 测试速率限制
for i in {1..1000}; do
  curl -X GET "http://localhost:8888/api/health" &
done
wait
# 预期: 部分返回 429 Too Many Requests
```

**成功标准**:
- ✅ 所有恶意请求被拒绝
- ✅ 无SQL注入漏洞
- ✅ 速率限制生效
- ✅ 无崩溃或错误

---

### **Day 7: 长时间稳定性测试** ⏱️

**测试内容**:
- [ ] 24小时持续运行
- [ ] 定期API调用
- [ ] 监控内存使用
- [ ] 监控CPU使用
- [ ] 检查日志错误

**监控脚本**:
```bash
# 创建监控脚本
cat > monitor.sh << 'EOF'
#!/bin/bash
while true; do
  # 记录时间
  echo "$(date): 监控检查"
  
  # 健康检查
  curl -s "http://localhost:8888/api/health" || echo "❌ 健康检查失败"
  
  # 查询余额
  curl -s -X GET "http://localhost:8888/api/wallets/wallet_1/balance?network=sepolia" \
    -H "Authorization: testnet_api_key" || echo "❌ 余额查询失败"
  
  # 等待5分钟
  sleep 300
done
EOF

chmod +x monitor.sh
./monitor.sh > monitor.log 2>&1 &
```

**成功标准**:
- ✅ 24小时无崩溃
- ✅ 内存使用稳定 (< 500MB)
- ✅ CPU使用正常 (< 10%)
- ✅ 所有API调用成功
- ✅ 无错误日志

---

## 📊 监控指标

### **实时监控**

```bash
# CPU和内存使用
top -p $(pgrep hot_wallet)

# 日志监控
tail -f logs/wallet.log

# 数据库大小
du -h data/testnet_wallet.db

# API响应时间
time curl -X GET "http://localhost:8888/api/health"
```

### **每日记录表**

| 日期 | 运行时间 | API成功率 | 平均响应时间 | 错误数 | 问题 |
|-----|---------|-----------|------------|--------|------|
| Day 1 |  |  |  |  |  |
| Day 2 |  |  |  |  |  |
| Day 3 |  |  |  |  |  |
| Day 4 |  |  |  |  |  |
| Day 5 |  |  |  |  |  |
| Day 6 |  |  |  |  |  |
| Day 7 |  |  |  |  |  |

---

## 🐛 问题跟踪

### **发现的问题**
```
问题1: _______________
严重性: 高/中/低
重现步骤: _______________
解决方案: _______________

问题2: _______________
...
```

---

## ✅ 测试总结

### **完成后评估**
- [ ] 所有核心功能正常
- [ ] 无严重Bug
- [ ] 性能达标
- [ ] 安全性验证通过
- [ ] 准备进入生产环境

### **下一步**
- [ ] 修复发现的问题
- [ ] 完善监控和告警
- [ ] 准备生产环境部署
- [ ] 继续前端开发

---

**测试负责人**: _______________  
**开始日期**: _______________  
**结束日期**: _______________

